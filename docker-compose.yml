version: '3.8'

services:
  wuzapi:
    build: .
    container_name: wuzapi
    restart: unless-stopped
    ports:
      - "8080:8080"
    command: printenv
    environment:
      # WuzAPI Configuration
      - WUZAPI_PORT=8080
      - WUZAPI_ADMIN_TOKEN=${WUZAPI_ADMIN_TOKEN}
      - WUZAPI_GLOBAL_ENCRYPTION_KEY=${WUZAPI_GLOBAL_ENCRYPTION_KEY}
      - WUZAPI_GLOBAL_HMAC_KEY=${WUZAPI_GLOBAL_HMAC_KEY}
      - WUZAPI_GLOBAL_WEBHOOK=${WUZAPI_GLOBAL_WEBHOOK}
      - WEBHOOK_FORMAT=${WEBHOOK_FORMAT:-json}
      - SESSION_DEVICE_NAME=${SESSION_DEVICE_NAME:-Metrizap}
      - TZ=${TZ:-America/Sao_Paulo}
      
      # Database Configuration - Passed directly from EasyPanel's .env
      - DB_USER=${DB_USER}
      - DB_PASSWORD=${DB_PASSWORD}
      - DB_NAME=${DB_NAME}
      - DB_HOST=${DB_HOST}
      - DB_PORT=${DB_PORT}
      - DB_SSLMODE=${DB_SSLMODE}
      
      # RabbitMQ (Optional)
      - RABBITMQ_URL=${RABBITMQ_URL:-}
      - RABBITMQ_QUEUE=${RABBITMQ_QUEUE:-whatsapp_events}
    volumes:
      - wuzapi-files:/root/files:rw
    networks:
      - wuzapi-network
    # Ensure proper permissions for volume mounts
    user: "${DOCKER_USER:-root}"

networks:
  wuzapi-network:
    driver: bridge

volumes:
  wuzapi-files:
